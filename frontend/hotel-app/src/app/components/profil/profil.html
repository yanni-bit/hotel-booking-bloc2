<main class="profil-page py-5">
  <div class="container">

    <h1 class="h3 mb-4 text-turquoise">
      <i class="bi bi-person-circle me-2"></i>{{ 'profile.title' | translate }}
    </h1>

    <div class="row">
      <div class="col-lg-8">

        <!-- CARD INFORMATIONS -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body p-4">

            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2 class="h5 mb-0">{{ 'profile.personalInfo' | translate }}</h2>
              <button class="btn btn-sm btn-outline-primary" (click)="toggleEditMode()" *ngIf="!editMode">
                <i class="bi bi-pencil me-1"></i>{{ 'common.edit' | translate }}
              </button>
            </div>

            <!-- MODE LECTURE -->
            <div *ngIf="!editMode">
              <div class="row mb-3">
                <div class="col-md-3">
                  <strong>{{ 'booking.firstName' | translate }} :</strong>
                </div>
                <div class="col-md-9">
                  {{ authService.currentUser()?.prenom }}
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-md-3">
                  <strong>{{ 'booking.lastName' | translate }} :</strong>
                </div>
                <div class="col-md-9">
                  {{ authService.currentUser()?.nom }}
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-md-3">
                  <strong>{{ 'booking.email' | translate }} :</strong>
                </div>
                <div class="col-md-9">
                  {{ authService.currentUser()?.email }}
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-md-3">
                  <strong>{{ 'booking.phone' | translate }} :</strong>
                </div>
                <div class="col-md-9">
                  {{ profileForm.telephone || ('hotel.notProvided' | translate) }}
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-md-3">
                  <strong>{{ 'profile.role' | translate }} :</strong>
                </div>
                <div class="col-md-9">
                  <span class="badge bg-primary">{{ authService.currentUser()?.role }}</span>
                </div>
              </div>
            </div>

            <!-- MODE Ã‰DITION -->
            <form *ngIf="editMode" (ngSubmit)="saveProfile()">

              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label fw-bold">{{ 'booking.firstName' | translate }} *</label>
                  <input type="text" class="form-control" [(ngModel)]="profileForm.prenom" name="prenom" required>
                </div>

                <div class="col-md-6">
                  <label class="form-label fw-bold">{{ 'booking.lastName' | translate }} *</label>
                  <input type="text" class="form-control" [(ngModel)]="profileForm.nom" name="nom" required>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold">{{ 'booking.email' | translate }}</label>
                <input type="email" class="form-control" [value]="authService.currentUser()?.email" disabled>
                <small class="text-muted">{{ 'profile.emailCannotChange' | translate }}</small>
              </div>

              <div class="mb-4">
                <label class="form-label fw-bold">{{ 'booking.phone' | translate }}</label>
                <input type="tel" class="form-control" [(ngModel)]="profileForm.telephone" name="telephone"
                  placeholder="+33 6 12 34 56 78">
              </div>

              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary" [disabled]="submitting">
                  <span *ngIf="!submitting">
                    <i class="bi bi-check-circle me-2"></i>{{ 'common.save' | translate }}
                  </span>
                  <span *ngIf="submitting">
                    <span class="spinner-border spinner-border-sm me-2"></span>{{ 'profile.saving' | translate }}
                  </span>
                </button>

                <button type="button" class="btn btn-secondary" (click)="toggleEditMode()" [disabled]="submitting">
                  <i class="bi bi-x-circle me-2"></i>{{ 'common.cancel' | translate }}
                </button>
              </div>

            </form>

          </div>
        </div>

        <!-- CARD MOT DE PASSE -->
        <div class="card border-0 shadow-sm">
          <div class="card-body p-4">

            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2 class="h5 mb-0">{{ 'auth.password' | translate }}</h2>
              <button class="btn btn-sm btn-outline-primary" (click)="togglePasswordForm()" *ngIf="!showPasswordForm">
                <i class="bi bi-key me-1"></i>{{ 'profile.change' | translate }}
              </button>
            </div>

            <div *ngIf="!showPasswordForm">
              <p class="text-muted mb-0">
                <i class="bi bi-lock me-2"></i>{{ 'profile.passwordSecure' | translate }}
              </p>
            </div>

            <!-- FORMULAIRE CHANGEMENT MOT DE PASSE -->
            <form *ngIf="showPasswordForm" (ngSubmit)="changePassword()">

              <div class="mb-3">
                <label class="form-label fw-bold">{{ 'profile.oldPassword' | translate }} *</label>
                <div class="password-input-group">
                  <input [type]="showOldPassword ? 'text' : 'password'" class="form-control"
                    [(ngModel)]="passwordForm.oldPassword" name="oldPassword" required autocomplete="current-password">
                  <button type="button" class="btn-toggle-password" (click)="toggleOldPassword()">
                    <i [class]="showOldPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                  </button>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold">{{ 'profile.newPassword' | translate }} *</label>
                <div class="password-input-group">
                  <input [type]="showNewPassword ? 'text' : 'password'" class="form-control"
                    [(ngModel)]="passwordForm.newPassword" name="newPassword" required autocomplete="new-password">
                  <button type="button" class="btn-toggle-password" (click)="toggleNewPassword()">
                    <i [class]="showNewPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                  </button>
                </div>
                <small class="text-muted">{{ 'profile.minChars' | translate }}</small>
              </div>

              <div class="mb-4">
                <label class="form-label fw-bold">{{ 'profile.confirmNewPassword' | translate }} *</label>
                <div class="password-input-group">
                  <input [type]="showConfirmPassword ? 'text' : 'password'" class="form-control"
                    [(ngModel)]="passwordForm.confirmPassword" name="confirmPassword" required
                    autocomplete="new-password">
                  <button type="button" class="btn-toggle-password" (click)="toggleConfirmPassword()">
                    <i [class]="showConfirmPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                  </button>
                </div>
              </div>

              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary" [disabled]="submitting">
                  <span *ngIf="!submitting">
                    <i class="bi bi-check-circle me-2"></i>{{ 'profile.changePassword' | translate }}
                  </span>
                  <span *ngIf="submitting">
                    <span class="spinner-border spinner-border-sm me-2"></span>{{ 'profile.changing' | translate }}
                  </span>
                </button>

                <button type="button" class="btn btn-secondary" (click)="togglePasswordForm()" [disabled]="submitting">
                  <i class="bi bi-x-circle me-2"></i>{{ 'common.cancel' | translate }}
                </button>
              </div>

            </form>

          </div>
        </div>

      </div>
    </div>

  </div>
</main>